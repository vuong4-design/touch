from dataclasses import dataclass
from datetime import datetime, timedelta
from typing import Optional


@dataclass
class ResourceLock:
    owner_id: str
    expires_at: datetime

    def expired(self, now: Optional[datetime] = None) -> bool:
        now = now or datetime.utcnow()
        return now >= self.expires_at


class ResourceLockManager:
    def __init__(self) -> None:
        self._lock: Optional[ResourceLock] = None

    def acquire(self, owner_id: str, ttl_ms: int) -> bool:
        now = datetime.utcnow()
        if self._lock and not self._lock.expired(now):
            return False
        self._lock = ResourceLock(
            owner_id=owner_id,
            expires_at=now + timedelta(milliseconds=ttl_ms),
        )
        return True

    def release(self, owner_id: str) -> bool:
        if not self._lock or self._lock.owner_id != owner_id:
            return False
        self._lock = None
        return True

    def check_owner(self, owner_id: str) -> bool:
        if not self._lock:
            return False
        if self._lock.expired():
            self._lock = None
            return False
        return self._lock.owner_id == owner_id
